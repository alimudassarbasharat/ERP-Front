import{M as z,H as L,l as h,p as T,y as A,f as p,o as a,D as y,d as o,h as c,a as i,ao as E,u as r,a3 as b,aN as H,F as k,z as v,b as O,t as D,aw as N,ap as P,e as F,r as U,aO as q,ay as S,ax as G,as as I,R as x}from"./index-xvPUEXLW.js";import{_ as J}from"./ActivityItem-Xa4YSpzk.js";const K={class:"w-full mb-4"},Q={class:"bg-white dark:bg-gray-800 rounded-xl p-6 shadow-lg border border-gray-200 dark:border-gray-700"},W={key:0,class:"flex justify-center py-8"},X={key:1,class:"space-y-4"},Y={class:"flex items-start justify-between mb-4"},Z={class:"flex-1"},ee={class:"font-semibold text-gray-900 dark:text-white mb-1"},se={key:0,class:"mt-4 p-4 bg-white dark:bg-gray-700 rounded-lg"},te={class:"space-y-2"},ae={class:"mt-4 flex justify-end"},le={class:"w-full mb-4"},oe={class:"bg-white dark:bg-gray-800 rounded-xl p-6 shadow-lg border border-gray-200 dark:border-gray-700"},re={key:0,class:"space-y-4"},de={__name:"ExamResults",setup(ie){const j=z(),d=L(),m=h([]),_=h([]),f=h({}),g=h(!1),u=h({}),w=e=>e?new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"Not set",C=async()=>{try{const e=await x.get("/exams");if(e.data.success||e.data.status){const t=e.data.result||e.data.data||[];m.value=t.filter(l=>l.status==="locked"),_.value=t.filter(l=>l.status==="published");for(const l of m.value)await R(l)}}catch(e){d.error("Failed to load exams"),console.error(e)}},R=async e=>{if(!u.value[e.id]){g.value=!0;try{const t=await x.get(`/exam-management/exams/${e.id}/publish-checklist`);t.data.success&&(u.value[e.id]=t.data.data.checklist||[])}catch(t){d.error("Failed to load checklist"),console.error(t)}finally{g.value=!1}}},$=e=>{const t=u.value[e];return t?t.every(l=>l.passed):!1},B=async e=>{var t,l;if(!$(e.id)){d.warning("Cannot publish: Some checklist items are not passed");return}f.value[e.id]=!0;try{const s=await x.post(`/exam-management/exams/${e.id}/publish-results`,{confirm:!0});s.data.success&&(s.data.job_batch_id?d.success("Results are being published. This may take a few minutes."):d.success("Results published successfully. Parents will be notified."),C())}catch(s){d.error(((l=(t=s.response)==null?void 0:t.data)==null?void 0:l.message)||"Failed to publish results")}finally{f.value[e.id]=!1}},M=e=>{j.push(`/exams/view-marksheet?exam=${e.id}`)};return T(()=>{C()}),(e,t)=>{const l=A("el-icon");return a(),p(I,{title:"Exam Results",breadcrumbs:[{label:"Exam Management",route:"/exams/center"},{label:"Results"}]},{default:y(()=>[o("div",K,[o("div",Q,[c(E,{title:"Ready to Show",icon:r(b)},null,8,["icon"]),g.value?(a(),i("div",W,[c(l,{class:"is-loading text-4xl"},{default:y(()=>[c(r(H))]),_:1})])):m.value.length>0?(a(),i("div",X,[(a(!0),i(k,null,v(m.value,s=>(a(),i("div",{key:s.id,class:"p-4 bg-green-50 dark:bg-green-900/20 rounded-lg border border-green-200 dark:border-green-800 hover:bg-green-100 dark:hover:bg-green-900/30 transition-colors"},[o("div",Y,[o("div",Z,[o("h3",ee,D(s.name||s.term),1),t[0]||(t[0]=o("p",{class:"text-sm text-gray-600 dark:text-gray-400"},"All checks are complete. Ready to show to parents.",-1))]),c(N,{label:"Show Checklist",icon:r(P),variant:"info",onClick:n=>R(s)},null,8,["icon","onClick"])]),u.value[s.id]?(a(),i("div",se,[t[1]||(t[1]=o("h4",{class:"font-semibold text-gray-900 dark:text-white mb-3"},"Publish Checklist",-1)),o("div",te,[(a(!0),i(k,null,v(u.value[s.id],(n,V)=>(a(),i("div",{key:V,class:"flex items-center gap-2"},[c(l,{class:F(n.passed?"text-green-600":"text-red-600")},{default:y(()=>[(a(),p(U(n.passed?r(b):r(q))))]),_:2},1032,["class"]),o("span",{class:F(n.passed?"text-gray-700 dark:text-gray-300":"text-red-600 dark:text-red-400")},D(n.message),3)]))),128))]),o("div",ae,[c(N,{label:"Publish Results",icon:r(b),variant:"success",disabled:!$(s.id),loading:f.value[s.id],onClick:n=>B(s)},null,8,["icon","disabled","loading","onClick"])])])):O("",!0)]))),128))])):(a(),p(S,{key:2,title:"No exams ready",description:"Complete all checks to publish results",icon:r(b),"icon-color":"green"},null,8,["icon"]))])]),o("div",le,[o("div",oe,[c(E,{title:"Published Results",icon:r(G)},null,8,["icon"]),_.value.length>0?(a(),i("div",re,[(a(!0),i(k,null,v(_.value,s=>(a(),p(J,{key:s.id,title:s.name||s.term,description:`Published on ${w(s.published_at)}`,time:w(s.published_at),type:"payment",icon:r(b),onClick:n=>M(s)},null,8,["title","description","time","icon","onClick"]))),128))])):(a(),p(S,{key:1,title:"No published results",description:"Published results will appear here",icon:r(P),"icon-color":"gray"},null,8,["icon"]))])])]),_:1})}}};export{de as default};
