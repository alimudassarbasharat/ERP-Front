import{M as le,H as ae,l as i,c as q,p as oe,y as I,N as re,a as n,o as r,d as t,i as m,b as w,h as v,u as J,U as ne,A as d,B as $,C as ie,F as U,z as N,t as c,f as ue,D as h,ap as de,ay as pe,J as C,K as _,R as g}from"./index-xvPUEXLW.js";import{_ as me}from"./StatusChip--xfdpyNX.js";const ve={class:"relative w-full min-h-screen pl-0 pr-0 sm:pl-0 sm:pr-0 lg:pl-1 lg:pr-0 py-2 sm:py-3 lg:py-4"},ce={class:"relative z-10 w-full mt-2 mb-4 flex items-center justify-between bg-white/90 rounded-lg shadow-lg py-2 px-5 transition-all duration-500 border border-gray-200"},fe={class:"flex items-center gap-2 text-base font-medium text-gray-600"},xe={class:"relative z-10 w-full"},be={class:"mb-4 flex items-center justify-between flex-wrap gap-3"},ge={class:"flex items-center gap-3"},ye=["value"],we={class:"bg-white/90 rounded-xl shadow-lg border border-gray-200 overflow-hidden"},he={class:"flex items-center gap-2"},ke=["onClick"],Ce=["onClick"],_e=["onClick"],je=["onClick"],Pe={key:0,class:"p-12 text-center"},$e={class:"flex flex-col w-full"},Se={class:"relative"},Ve=["value"],Ae={class:"flex flex-col w-full"},Me={class:"relative"},Ue=["value"],Ne={class:"flex flex-col w-full"},De={class:"relative"},Ee=["value"],Fe={class:"flex flex-col w-full"},Re={class:"relative"},ze={class:"grid grid-cols-2 gap-4"},Be={class:"flex flex-col w-full"},Te={class:"relative"},qe={class:"flex flex-col w-full"},Ie={class:"relative"},Je={class:"flex flex-col w-full"},Le={class:"relative"},Oe={class:"flex gap-3 pt-4"},He=["disabled"],Ke={class:"flex flex-col w-full"},Ge={class:"relative"},Qe={class:"flex gap-3 pt-4"},We=["disabled"],Xe={class:"flex flex-col w-full"},Ye={class:"relative"},Ze={class:"flex gap-3 pt-4"},et=["disabled"],at={__name:"ExamPapers",setup(tt){const F=le(),p=ae(),S=i(!1),V=i(!1),f=i(!1),D=i([]),E=i([]),R=i([]),z=i([]),b=i({status:null,exam_id:null}),k=i(!1),j=i(!1),P=i(!1),A=i(null),o=i({exam_id:null,class_id:null,subject_id:null,title:"",total_marks:100,duration_minutes:120,instructions:""}),x=i({comment:""}),L=q(()=>{try{const l=JSON.parse(localStorage.getItem("user")||"{}");return l.role||l.user_type||l.type||"guest"}catch{return"guest"}}),B=q(()=>["supervisor","admin","super-admin"].includes(L.value)),O=l=>({draft:"info",submitted:"warning",approved:"success",rejected:"danger",locked:"default"})[l]||"default",y=async()=>{S.value=!0;try{const l={};b.value.status&&(l.status=b.value.status),b.value.exam_id&&(l.exam_id=b.value.exam_id);const e=await g.get("/exam-papers",{params:l});e.data.success&&(D.value=e.data.data.data||e.data.data||[])}catch(l){p.error("Failed to load papers"),console.error(l)}finally{S.value=!1}},H=async()=>{try{const l=await g.get("/exams");(l.data.success||l.data.status)&&(E.value=l.data.result||l.data.data||[])}catch(l){console.error("Failed to load exams:",l)}},K=async()=>{try{const l=await g.get("/classes");(l.data.success||l.data.status)&&(R.value=l.data.result||l.data.data||[])}catch(l){console.error("Failed to load classes:",l)}},G=async()=>{try{const l=await g.get("/subjects");(l.data.success||l.data.status)&&(z.value=l.data.result||l.data.data||[])}catch(l){console.error("Failed to load subjects:",l)}},Q=async()=>{var l,e;if(!o.value.exam_id||!o.value.class_id||!o.value.subject_id||!o.value.title){p.warning("Please fill all required fields");return}V.value=!0;try{const a=await g.post("/exam-papers",o.value);a.data.success&&(p.success("Paper created successfully"),k.value=!1,o.value={exam_id:null,class_id:null,subject_id:null,title:"",total_marks:100,duration_minutes:120,instructions:""},y(),F.push(`/exams/papers/${a.data.data.id}`))}catch(a){p.error(((e=(l=a.response)==null?void 0:l.data)==null?void 0:e.message)||"Failed to create paper")}finally{V.value=!1}},W=l=>{F.push(`/exams/papers/${l.id}`)},X=async l=>{var e,a;f.value=!0;try{(await g.post(`/exam-papers/${l.id}/submit`)).data.success&&(p.success("Paper submitted for review"),y())}catch(M){p.error(((a=(e=M.response)==null?void 0:e.data)==null?void 0:a.message)||"Failed to submit paper")}finally{f.value=!1}},Y=l=>{A.value=l,x.value.comment="",j.value=!0},Z=async()=>{var l,e;f.value=!0;try{(await g.post(`/exam-papers/${A.value.id}/approve`,{comment:x.value.comment})).data.success&&(p.success("Paper approved successfully"),j.value=!1,y())}catch(a){p.error(((e=(l=a.response)==null?void 0:l.data)==null?void 0:e.message)||"Failed to approve paper")}finally{f.value=!1}},ee=l=>{A.value=l,x.value.comment="",P.value=!0},te=async()=>{var l,e;if(!x.value.comment){p.warning("Please provide a reason for rejection");return}f.value=!0;try{(await g.post(`/exam-papers/${A.value.id}/reject`,{comment:x.value.comment})).data.success&&(p.success("Paper rejected"),P.value=!1,y())}catch(a){p.error(((e=(l=a.response)==null?void 0:l.data)==null?void 0:e.message)||"Failed to reject paper")}finally{f.value=!1}};return oe(()=>{y(),H(),K(),G()}),(l,e)=>{const a=I("el-table-column"),M=I("el-table"),se=re("loading");return r(),n("div",ve,[t("div",ce,[e[25]||(e[25]=t("h2",{class:"text-base font-medium text-gray-900 tracking-tight flex items-center gap-2"},[t("div",{class:"w-2 h-2 bg-gradient-to-r from-purple-500 to-pink-500 rounded-full animate-pulse"}),m(" Exam Papers Management ")],-1)),t("nav",fe,[t("span",{class:"hover:text-purple-600 cursor-pointer transition-colors duration-200",onClick:e[0]||(e[0]=s=>l.$router.push("/exams/center"))},"Exam Management"),e[23]||(e[23]=t("span",{class:"mx-2"},"|",-1)),e[24]||(e[24]=t("span",{class:"text-gray-900 font-bold"},"Papers",-1))])]),t("div",xe,[t("div",be,[t("button",{onClick:e[1]||(e[1]=s=>k.value=!0),class:"h-10 px-6 rounded-full bg-gradient-to-r from-purple-500 to-pink-500 text-sm font-bold text-white shadow hover:from-purple-600 hover:to-pink-600 transition-all duration-300 flex items-center gap-2"},[v(J(ne),{class:"w-4 h-4"}),e[26]||(e[26]=m(" Create Paper ",-1))]),t("div",ge,[d(t("select",{"onUpdate:modelValue":e[2]||(e[2]=s=>b.value.status=s),onChange:y,class:"h-10 px-4 border-0 bg-transparent text-sm font-light text-gray-600 focus:ring-0 focus:outline-none appearance-none pr-8 border-b-2 border-purple-200"},[...e[27]||(e[27]=[ie('<option value="">All Status</option><option value="draft">Draft</option><option value="submitted">Submitted</option><option value="approved">Approved</option><option value="rejected">Rejected</option><option value="locked">Locked</option>',6)])],544),[[$,b.value.status]]),d(t("select",{"onUpdate:modelValue":e[3]||(e[3]=s=>b.value.exam_id=s),onChange:y,class:"h-10 px-4 border-0 bg-transparent text-sm font-light text-gray-600 focus:ring-0 focus:outline-none appearance-none pr-8 border-b-2 border-purple-200"},[e[28]||(e[28]=t("option",{value:""},"All Exams",-1)),(r(!0),n(U,null,N(E.value,s=>(r(),n("option",{key:s.id,value:s.id},c(s.name||s.term),9,ye))),128))],544),[[$,b.value.exam_id]])])]),t("div",we,[d((r(),ue(M,{data:D.value,stripe:"",style:{width:"100%"}},{default:h(()=>[v(a,{prop:"title",label:"Paper Title","min-width":"200"}),v(a,{label:"Exam","min-width":"150"},{default:h(({row:s})=>{var u,T;return[m(c(((u=s.exam)==null?void 0:u.name)||((T=s.exam)==null?void 0:T.term)||"N/A"),1)]}),_:1}),v(a,{label:"Class","min-width":"120"},{default:h(({row:s})=>{var u;return[m(c(((u=s.class)==null?void 0:u.name)||"N/A"),1)]}),_:1}),v(a,{label:"Subject","min-width":"120"},{default:h(({row:s})=>{var u;return[m(c(((u=s.subject)==null?void 0:u.name)||"N/A"),1)]}),_:1}),v(a,{prop:"total_marks",label:"Total Marks",width:"120"}),v(a,{label:"Status",width:"130"},{default:h(({row:s})=>[v(me,{label:s.status,status:O(s.status)},null,8,["label","status"])]),_:1}),v(a,{label:"Version",width:"100"},{default:h(({row:s})=>[m(" v"+c(s.paper_version),1)]),_:1}),v(a,{label:"Actions",width:"200",fixed:"right"},{default:h(({row:s})=>[t("div",he,[t("button",{onClick:u=>W(s),class:"text-purple-600 hover:text-purple-800 text-sm font-medium"}," View ",8,ke),s.status==="draft"?(r(),n("button",{key:0,onClick:u=>X(s),class:"text-green-600 hover:text-green-800 text-sm font-medium"}," Submit ",8,Ce)):w("",!0),s.status==="submitted"&&B.value?(r(),n("button",{key:1,onClick:u=>Y(s),class:"text-blue-600 hover:text-blue-800 text-sm font-medium"}," Approve ",8,_e)):w("",!0),s.status==="submitted"&&B.value?(r(),n("button",{key:2,onClick:u=>ee(s),class:"text-red-600 hover:text-red-800 text-sm font-medium"}," Reject ",8,je)):w("",!0)])]),_:1})]),_:1},8,["data"])),[[se,S.value]]),!S.value&&D.value.length===0?(r(),n("div",Pe,[v(pe,{title:"No papers found",description:"Create your first exam paper to get started",icon:J(de),"icon-color":"blue","action-label":"Create Paper",onAction:e[4]||(e[4]=s=>k.value=!0)},null,8,["icon"])])):w("",!0)]),k.value?(r(),n("div",{key:0,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",onClick:e[14]||(e[14]=s=>k.value=!1)},[t("div",{class:"bg-white rounded-xl shadow-2xl w-full max-w-2xl transform transition-all duration-300 max-h-[90vh] overflow-y-auto",onClick:e[13]||(e[13]=C(()=>{},["stop"]))},[e[49]||(e[49]=t("div",{class:"px-6 py-4 border-b border-gray-200"},[t("h3",{class:"text-lg font-semibold text-gray-900"},"Create Exam Paper")],-1)),t("form",{onSubmit:C(Q,["prevent"]),class:"p-6 space-y-4"},[t("div",$e,[e[32]||(e[32]=t("label",{class:"mb-1 text-xs font-semibold text-gray-600 uppercase tracking-wider"},[m("Exam "),t("span",{class:"text-red-500"},"*")],-1)),t("div",Se,[d(t("select",{"onUpdate:modelValue":e[5]||(e[5]=s=>o.value.exam_id=s),required:"",class:"h-10 border-0 bg-transparent px-0 text-sm font-light text-gray-600 focus:ring-0 focus:outline-none w-full appearance-none pr-8"},[e[29]||(e[29]=t("option",{value:""},"Select Exam",-1)),(r(!0),n(U,null,N(E.value,s=>(r(),n("option",{key:s.id,value:s.id},c(s.name||s.term),9,Ve))),128))],512),[[$,o.value.exam_id]]),e[30]||(e[30]=t("div",{class:"absolute right-2 top-1/2 -translate-y-1/2 pointer-events-none"},[t("svg",{class:"w-4 h-4 text-gray-500",fill:"none",stroke:"currentColor","stroke-width":"1.5",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 5v14m0 0l-5-5m5 5l5-5"})])],-1)),e[31]||(e[31]=t("div",{class:"absolute left-0 right-0 bottom-0 h-[2px] bg-purple-200 pointer-events-none"},null,-1))])]),t("div",Ae,[e[36]||(e[36]=t("label",{class:"mb-1 text-xs font-semibold text-gray-600 uppercase tracking-wider"},[m("Class "),t("span",{class:"text-red-500"},"*")],-1)),t("div",Me,[d(t("select",{"onUpdate:modelValue":e[6]||(e[6]=s=>o.value.class_id=s),required:"",class:"h-10 border-0 bg-transparent px-0 text-sm font-light text-gray-600 focus:ring-0 focus:outline-none w-full appearance-none pr-8"},[e[33]||(e[33]=t("option",{value:""},"Select Class",-1)),(r(!0),n(U,null,N(R.value,s=>(r(),n("option",{key:s.id,value:s.id},c(s.name),9,Ue))),128))],512),[[$,o.value.class_id]]),e[34]||(e[34]=t("div",{class:"absolute right-2 top-1/2 -translate-y-1/2 pointer-events-none"},[t("svg",{class:"w-4 h-4 text-gray-500",fill:"none",stroke:"currentColor","stroke-width":"1.5",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 5v14m0 0l-5-5m5 5l5-5"})])],-1)),e[35]||(e[35]=t("div",{class:"absolute left-0 right-0 bottom-0 h-[2px] bg-purple-200 pointer-events-none"},null,-1))])]),t("div",Ne,[e[40]||(e[40]=t("label",{class:"mb-1 text-xs font-semibold text-gray-600 uppercase tracking-wider"},[m("Subject "),t("span",{class:"text-red-500"},"*")],-1)),t("div",De,[d(t("select",{"onUpdate:modelValue":e[7]||(e[7]=s=>o.value.subject_id=s),required:"",class:"h-10 border-0 bg-transparent px-0 text-sm font-light text-gray-600 focus:ring-0 focus:outline-none w-full appearance-none pr-8"},[e[37]||(e[37]=t("option",{value:""},"Select Subject",-1)),(r(!0),n(U,null,N(z.value,s=>(r(),n("option",{key:s.id,value:s.id},c(s.name),9,Ee))),128))],512),[[$,o.value.subject_id]]),e[38]||(e[38]=t("div",{class:"absolute right-2 top-1/2 -translate-y-1/2 pointer-events-none"},[t("svg",{class:"w-4 h-4 text-gray-500",fill:"none",stroke:"currentColor","stroke-width":"1.5",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 5v14m0 0l-5-5m5 5l5-5"})])],-1)),e[39]||(e[39]=t("div",{class:"absolute left-0 right-0 bottom-0 h-[2px] bg-purple-200 pointer-events-none"},null,-1))])]),t("div",Fe,[e[42]||(e[42]=t("label",{class:"mb-1 text-xs font-semibold text-gray-600 uppercase tracking-wider"},[m("Title "),t("span",{class:"text-red-500"},"*")],-1)),t("div",Re,[d(t("input",{"onUpdate:modelValue":e[8]||(e[8]=s=>o.value.title=s),type:"text",placeholder:"Paper title",required:"",class:"h-10 border-0 bg-transparent px-0 text-sm font-light text-gray-600 focus:ring-0 focus:outline-none w-full"},null,512),[[_,o.value.title]]),e[41]||(e[41]=t("div",{class:"absolute left-0 right-0 bottom-0 h-[2px] bg-purple-200 pointer-events-none"},null,-1))])]),t("div",ze,[t("div",Be,[e[44]||(e[44]=t("label",{class:"mb-1 text-xs font-semibold text-gray-600 uppercase tracking-wider"},"Total Marks",-1)),t("div",Te,[d(t("input",{"onUpdate:modelValue":e[9]||(e[9]=s=>o.value.total_marks=s),type:"number",min:"0",class:"h-10 border-0 bg-transparent px-0 text-sm font-light text-gray-600 focus:ring-0 focus:outline-none w-full"},null,512),[[_,o.value.total_marks,void 0,{number:!0}]]),e[43]||(e[43]=t("div",{class:"absolute left-0 right-0 bottom-0 h-[2px] bg-purple-200 pointer-events-none"},null,-1))])]),t("div",qe,[e[46]||(e[46]=t("label",{class:"mb-1 text-xs font-semibold text-gray-600 uppercase tracking-wider"},"Duration (minutes)",-1)),t("div",Ie,[d(t("input",{"onUpdate:modelValue":e[10]||(e[10]=s=>o.value.duration_minutes=s),type:"number",min:"0",class:"h-10 border-0 bg-transparent px-0 text-sm font-light text-gray-600 focus:ring-0 focus:outline-none w-full"},null,512),[[_,o.value.duration_minutes,void 0,{number:!0}]]),e[45]||(e[45]=t("div",{class:"absolute left-0 right-0 bottom-0 h-[2px] bg-purple-200 pointer-events-none"},null,-1))])])]),t("div",Je,[e[48]||(e[48]=t("label",{class:"mb-1 text-xs font-semibold text-gray-600 uppercase tracking-wider"},"Instructions",-1)),t("div",Le,[d(t("textarea",{"onUpdate:modelValue":e[11]||(e[11]=s=>o.value.instructions=s),placeholder:"Paper instructions",rows:"3",class:"border-0 bg-transparent px-0 text-sm font-light text-gray-600 focus:ring-0 focus:outline-none w-full resize-none"},null,512),[[_,o.value.instructions]]),e[47]||(e[47]=t("div",{class:"absolute left-0 right-0 bottom-0 h-[2px] bg-purple-200 pointer-events-none"},null,-1))])]),t("div",Oe,[t("button",{type:"button",onClick:e[12]||(e[12]=s=>k.value=!1),class:"flex-1 h-10 px-6 rounded-full bg-gradient-to-r from-gray-500 to-slate-500 text-sm font-bold text-white shadow hover:from-gray-600 hover:to-slate-600 transition-all duration-300"}," Cancel "),t("button",{type:"submit",disabled:V.value,class:"flex-1 h-10 px-6 rounded-full bg-gradient-to-r from-purple-500 to-pink-500 text-sm font-bold text-white shadow hover:from-purple-600 hover:to-pink-600 transition-all duration-300 disabled:opacity-50"},c(V.value?"Creating...":"Create"),9,He)])],32)])])):w("",!0),j.value?(r(),n("div",{key:1,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",onClick:e[18]||(e[18]=s=>j.value=!1)},[t("div",{class:"bg-white rounded-xl shadow-2xl w-full max-w-md transform transition-all duration-300",onClick:e[17]||(e[17]=C(()=>{},["stop"]))},[e[52]||(e[52]=t("div",{class:"px-6 py-4 border-b border-gray-200"},[t("h3",{class:"text-lg font-semibold text-gray-900"},"Approve Paper")],-1)),t("form",{onSubmit:C(Z,["prevent"]),class:"p-6 space-y-4"},[t("div",Ke,[e[51]||(e[51]=t("label",{class:"mb-1 text-xs font-semibold text-gray-600 uppercase tracking-wider"},"Comment",-1)),t("div",Ge,[d(t("textarea",{"onUpdate:modelValue":e[15]||(e[15]=s=>x.value.comment=s),placeholder:"Optional approval comment",rows:"3",class:"border-0 bg-transparent px-0 text-sm font-light text-gray-600 focus:ring-0 focus:outline-none w-full resize-none"},null,512),[[_,x.value.comment]]),e[50]||(e[50]=t("div",{class:"absolute left-0 right-0 bottom-0 h-[2px] bg-purple-200 pointer-events-none"},null,-1))])]),t("div",Qe,[t("button",{type:"button",onClick:e[16]||(e[16]=s=>j.value=!1),class:"flex-1 h-10 px-6 rounded-full bg-gradient-to-r from-gray-500 to-slate-500 text-sm font-bold text-white shadow hover:from-gray-600 hover:to-slate-600 transition-all duration-300"}," Cancel "),t("button",{type:"submit",disabled:f.value,class:"flex-1 h-10 px-6 rounded-full bg-gradient-to-r from-green-500 to-emerald-500 text-sm font-bold text-white shadow hover:from-green-600 hover:to-emerald-600 transition-all duration-300 disabled:opacity-50"},c(f.value?"Processing...":"Approve"),9,We)])],32)])])):w("",!0),P.value?(r(),n("div",{key:2,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",onClick:e[22]||(e[22]=s=>P.value=!1)},[t("div",{class:"bg-white rounded-xl shadow-2xl w-full max-w-md transform transition-all duration-300",onClick:e[21]||(e[21]=C(()=>{},["stop"]))},[e[55]||(e[55]=t("div",{class:"px-6 py-4 border-b border-gray-200"},[t("h3",{class:"text-lg font-semibold text-gray-900"},"Reject Paper")],-1)),t("form",{onSubmit:C(te,["prevent"]),class:"p-6 space-y-4"},[t("div",Xe,[e[54]||(e[54]=t("label",{class:"mb-1 text-xs font-semibold text-gray-600 uppercase tracking-wider"},[m("Reason "),t("span",{class:"text-red-500"},"*")],-1)),t("div",Ye,[d(t("textarea",{"onUpdate:modelValue":e[19]||(e[19]=s=>x.value.comment=s),placeholder:"Please provide reason for rejection",rows:"3",required:"",class:"border-0 bg-transparent px-0 text-sm font-light text-gray-600 focus:ring-0 focus:outline-none w-full resize-none"},null,512),[[_,x.value.comment]]),e[53]||(e[53]=t("div",{class:"absolute left-0 right-0 bottom-0 h-[2px] bg-purple-200 pointer-events-none"},null,-1))])]),t("div",Ze,[t("button",{type:"button",onClick:e[20]||(e[20]=s=>P.value=!1),class:"flex-1 h-10 px-6 rounded-full bg-gradient-to-r from-gray-500 to-slate-500 text-sm font-bold text-white shadow hover:from-gray-600 hover:to-slate-600 transition-all duration-300"}," Cancel "),t("button",{type:"submit",disabled:f.value,class:"flex-1 h-10 px-6 rounded-full bg-gradient-to-r from-red-500 to-pink-500 text-sm font-bold text-white shadow hover:from-red-600 hover:to-pink-600 transition-all duration-300 disabled:opacity-50"},c(f.value?"Processing...":"Reject"),9,et)])],32)])])):w("",!0)])])}}};export{at as default};
