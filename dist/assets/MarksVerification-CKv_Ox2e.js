import{H as J,l as r,p as K,y as m,f as M,o as n,D as o,h as l,d as s,a as d,F as $,z as D,ao as Q,u as C,a3 as F,aN as W,b as R,t as u,aw as X,i as x,ay as Y,as as Z,R as h}from"./index-xvPUEXLW.js";import{A as ee}from"./ActionBar-BRIEgU-p.js";import{_ as ae}from"./StatusChip--xfdpyNX.js";const te={class:"w-full mb-4"},se={class:"bg-white dark:bg-gray-800 rounded-xl p-6 shadow-lg border border-gray-200 dark:border-gray-700"},le={key:0,class:"flex justify-center py-12"},oe={key:1,class:"space-y-4"},ne={class:"flex items-center justify-between"},re={class:"flex-1"},ie={class:"flex items-center gap-3 mb-2"},de={class:"font-semibold text-gray-900 dark:text-white"},ue={class:"grid grid-cols-4 gap-4 text-sm"},ce={class:"font-semibold text-gray-900 dark:text-white"},me={class:"font-semibold text-gray-900 dark:text-white"},ve={class:"font-semibold text-gray-900 dark:text-white"},fe={class:"font-semibold text-gray-900 dark:text-white"},_e={key:0,class:"mt-2 text-xs text-gray-500 dark:text-gray-400"},ye={class:"flex gap-2"},pe={key:2,class:"bg-white dark:bg-gray-800 rounded-xl p-6 shadow-lg border border-gray-200 dark:border-gray-700"},ge={key:0,class:"space-y-4"},xe={class:"font-semibold"},be={class:"font-semibold"},ke={key:0,class:"space-y-4"},je={__name:"MarksVerification",setup(we){const v=J(),j=r(!1),f=r(!1),b=r([]),S=r([]),U=r([]),c=r({exam_id:null,class_id:null}),_=r(!1),y=r(!1),i=r(null),k=r(""),w=r(""),P=t=>new Date(t).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),V=async()=>{j.value=!0;try{const t={status:"submitted"};c.value.exam_id&&(t.exam_id=c.value.exam_id),c.value.class_id&&(t.class_id=c.value.class_id);const e=await h.get("/exam-marks",{params:t});e.data.success&&(b.value=e.data.data.data||e.data.data||[])}catch{v.warning("Verification endpoint not yet implemented. Using mock data."),b.value=[]}finally{j.value=!1}},z=async()=>{try{const t=await h.get("/exams");(t.data.success||t.data.status)&&(S.value=t.data.result||t.data.data||[])}catch(t){console.error("Failed to load exams:",t)}},L=async()=>{try{const t=await h.get("/classes");(t.data.success||t.data.status)&&(U.value=t.data.result||t.data.data||[])}catch(t){console.error("Failed to load classes:",t)}},T=t=>{i.value=t,k.value="",_.value=!0},q=async()=>{var t,e;f.value=!0;try{(await h.post("/exam-marks/verify",{exam_id:i.value.exam_id,class_ids:[i.value.class_id],subject_ids:[i.value.subject_id],verified_by:null,comment:k.value})).data.success&&(v.success("Marks verified successfully"),_.value=!1,V())}catch(p){v.error(((e=(t=p.response)==null?void 0:t.data)==null?void 0:e.message)||"Failed to verify marks")}finally{f.value=!1}},H=t=>{i.value=t,w.value="",y.value=!0},I=async()=>{if(!w.value){v.warning("Please provide a reason for rejection");return}f.value=!0;try{v.info("Rejection functionality to be implemented"),y.value=!1}catch{v.error("Failed to reject marks")}finally{f.value=!1}};return K(()=>{V(),z(),L()}),(t,e)=>{const p=m("el-option"),N=m("el-select"),O=m("el-icon"),g=m("el-button"),B=m("el-input"),E=m("el-form-item"),A=m("el-dialog");return n(),M(Z,{title:"Check Marks",breadcrumbs:[{label:"Exam Management",route:"/exams/center"},{label:"Marks Verification"}]},{default:o(()=>[l(ee,null,{default:o(()=>[l(N,{modelValue:c.value.exam_id,"onUpdate:modelValue":e[0]||(e[0]=a=>c.value.exam_id=a),placeholder:"Filter by Exam",clearable:"",filterable:"",class:"w-[200px]",onChange:V},{default:o(()=>[(n(!0),d($,null,D(S.value,a=>(n(),M(p,{key:a.id,label:a.name||a.term,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),l(N,{modelValue:c.value.class_id,"onUpdate:modelValue":e[1]||(e[1]=a=>c.value.class_id=a),placeholder:"Filter by Class",clearable:"",filterable:"",class:"w-[200px]",onChange:V},{default:o(()=>[(n(!0),d($,null,D(U.value,a=>(n(),M(p,{key:a.id,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),s("div",te,[s("div",se,[l(Q,{title:"Marks Pending Verification",icon:C(F)},null,8,["icon"]),j.value?(n(),d("div",le,[l(O,{class:"is-loading text-4xl"},{default:o(()=>[l(C(W))]),_:1})])):b.value.length>0?(n(),d("div",oe,[(n(!0),d($,null,D(b.value,a=>(n(),d("div",{key:a.id,class:"p-4 bg-gray-50 dark:bg-gray-700/50 rounded-lg border border-gray-200 dark:border-gray-600 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors"},[s("div",ne,[s("div",re,[s("div",ie,[s("p",de,u(a.student_name||`Student ID: ${a.student_id}`),1),l(ae,{label:"Submitted",status:"warning"})]),s("div",ue,[s("div",null,[e[8]||(e[8]=s("p",{class:"text-gray-500 dark:text-gray-400"},"Exam",-1)),s("p",ce,u(a.exam_name),1)]),s("div",null,[e[9]||(e[9]=s("p",{class:"text-gray-500 dark:text-gray-400"},"Class",-1)),s("p",me,u(a.class_name),1)]),s("div",null,[e[10]||(e[10]=s("p",{class:"text-gray-500 dark:text-gray-400"},"Subject",-1)),s("p",ve,u(a.subject_name),1)]),s("div",null,[e[11]||(e[11]=s("p",{class:"text-gray-500 dark:text-gray-400"},"Marks",-1)),s("p",fe,u(a.obtained_marks)+" / "+u(a.total_marks),1)])]),a.submitted_at?(n(),d("div",_e," Submitted: "+u(P(a.submitted_at)),1)):R("",!0)]),s("div",ye,[l(X,{label:"Verify",icon:C(F),variant:"success",onClick:G=>T(a)},null,8,["icon","onClick"]),l(g,{text:"",type:"danger",size:"small",onClick:G=>H(a)},{default:o(()=>[...e[12]||(e[12]=[x(" Reject ",-1)])]),_:1},8,["onClick"])])])]))),128))])):(n(),d("div",pe,[l(Y,{title:"No marks pending verification",description:"All submitted marks have been verified",icon:C(F),"icon-color":"green"},null,8,["icon"])]))])]),l(A,{modelValue:_.value,"onUpdate:modelValue":e[4]||(e[4]=a=>_.value=a),title:"Verify Marks",width:"500px"},{footer:o(()=>[l(g,{onClick:e[3]||(e[3]=a=>_.value=!1)},{default:o(()=>[...e[15]||(e[15]=[x("Cancel",-1)])]),_:1}),l(g,{type:"success",onClick:q,loading:f.value},{default:o(()=>[...e[16]||(e[16]=[x("Verify",-1)])]),_:1},8,["loading"])]),default:o(()=>[i.value?(n(),d("div",ge,[s("div",null,[e[13]||(e[13]=s("p",{class:"text-sm text-gray-500 dark:text-gray-400"},"Student",-1)),s("p",xe,u(i.value.student_name),1)]),s("div",null,[e[14]||(e[14]=s("p",{class:"text-sm text-gray-500 dark:text-gray-400"},"Marks",-1)),s("p",be,u(i.value.obtained_marks)+" / "+u(i.value.total_marks),1)]),l(E,{label:"Comment"},{default:o(()=>[l(B,{modelValue:k.value,"onUpdate:modelValue":e[2]||(e[2]=a=>k.value=a),type:"textarea",rows:3,placeholder:"Optional verification comment"},null,8,["modelValue"])]),_:1})])):R("",!0)]),_:1},8,["modelValue"]),l(A,{modelValue:y.value,"onUpdate:modelValue":e[7]||(e[7]=a=>y.value=a),title:"Reject Marks",width:"500px"},{footer:o(()=>[l(g,{onClick:e[6]||(e[6]=a=>y.value=!1)},{default:o(()=>[...e[17]||(e[17]=[x("Cancel",-1)])]),_:1}),l(g,{type:"danger",onClick:I,loading:f.value},{default:o(()=>[...e[18]||(e[18]=[x("Reject",-1)])]),_:1},8,["loading"])]),default:o(()=>[i.value?(n(),d("div",ke,[l(E,{label:"Reason",required:""},{default:o(()=>[l(B,{modelValue:w.value,"onUpdate:modelValue":e[5]||(e[5]=a=>w.value=a),type:"textarea",rows:3,placeholder:"Please provide reason for rejection"},null,8,["modelValue"])]),_:1})])):R("",!0)]),_:1},8,["modelValue"])]),_:1})}}};export{je as default};
