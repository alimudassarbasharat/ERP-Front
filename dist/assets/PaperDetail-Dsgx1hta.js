import{P as ee,M as te,H as se,l as x,c as ae,p as le,y as c,f as Q,o as u,D as r,a as p,b as v,h as t,u as b,aN as oe,d as l,t as d,aw as M,U as ne,a3 as re,ao as ie,ap as F,F as B,z as J,i as q,ay as ue,as as de,R as k}from"./index-xvPUEXLW.js";import{A as pe}from"./ActionBar-BRIEgU-p.js";import{_ as A}from"./StatusChip--xfdpyNX.js";const me={key:0,class:"flex justify-center py-12"},ce={key:1,class:"space-y-4"},_e={class:"bg-white dark:bg-gray-800 rounded-xl p-6 shadow-lg border border-gray-200 dark:border-gray-700"},ve={class:"flex items-center justify-between mb-4"},ye={class:"text-2xl font-bold text-gray-900 dark:text-white"},fe={class:"text-gray-600 dark:text-gray-400 mt-1"},xe={class:"grid grid-cols-3 gap-4 mb-4"},ge={class:"text-lg font-semibold text-gray-900 dark:text-white"},be={class:"text-lg font-semibold text-gray-900 dark:text-white"},ke={class:"text-lg font-semibold text-gray-900 dark:text-white"},we={key:0,class:"mb-4"},Ve={class:"text-gray-700 dark:text-gray-300"},he={class:"bg-white dark:bg-gray-800 rounded-xl p-6 shadow-lg border border-gray-200 dark:border-gray-700"},Qe={key:0,class:"space-y-4"},qe={class:"flex items-start justify-between mb-2"},Ce={class:"flex-1"},je={class:"flex items-center gap-2 mb-2"},$e={class:"text-sm font-semibold text-gray-500"},Ae={class:"text-sm font-semibold text-gray-900 dark:text-white"},Oe={class:"text-gray-900 dark:text-white mb-2"},Se={key:0,class:"text-sm text-gray-600 dark:text-gray-400"},Ne={class:"list-disc list-inside"},Ue={key:1,class:"mt-2"},Pe={class:"text-sm font-semibold text-green-600 dark:text-green-400"},De={key:0,class:"flex gap-2"},Te={__name:"PaperDetail",setup(Me){const T=ee(),E=te(),m=se(),C=x(!1),w=x(!1),o=x(null),y=x(!1),g=x(null),n=x({section_name:"",question_text:"",question_type:"short",marks:1,options_json:"",answer_key:"",order_no:0}),R=ae(()=>{var a;return(a=o.value)!=null&&a.questions?[...o.value.questions].sort((e,i)=>(e.order_no||0)-(i.order_no||0)):[]}),z=a=>({draft:"info",submitted:"warning",approved:"success",rejected:"danger",locked:"default"})[a]||"default",V=async()=>{C.value=!0;try{const a=await k.get(`/exam-papers/${T.params.id}`);a.data.success&&(o.value=a.data.data)}catch{m.error("Failed to load paper"),E.push("/exams/papers")}finally{C.value=!1}},I=async()=>{var a,e;try{(await k.post(`/exam-papers/${o.value.id}/submit`)).data.success&&(m.success("Paper submitted for review"),V())}catch(i){m.error(((e=(a=i.response)==null?void 0:a.data)==null?void 0:e.message)||"Failed to submit paper")}},L=async()=>{var a,e;if(!n.value.section_name||!n.value.question_text||!n.value.marks){m.warning("Please fill all required fields");return}w.value=!0;try{const i={...n.value};if(i.options_json)try{JSON.parse(i.options_json)}catch{m.error("Invalid JSON format for options"),w.value=!1;return}g.value?(await k.put(`/exam-papers/${o.value.id}/questions/${g.value.id}`,i),m.success("Question updated")):(await k.post(`/exam-papers/${o.value.id}/questions`,i),m.success("Question added")),y.value=!1,O(),V()}catch(i){m.error(((e=(a=i.response)==null?void 0:a.data)==null?void 0:e.message)||"Failed to save question")}finally{w.value=!1}},H=a=>{g.value=a,n.value={section_name:a.section_name,question_text:a.question_text,question_type:a.question_type,marks:a.marks,options_json:a.options_json?JSON.stringify(JSON.parse(a.options_json),null,2):"",answer_key:a.answer_key||"",order_no:a.order_no||0},y.value=!0},K=async a=>{var e,i;try{await k.delete(`/exam-papers/${o.value.id}/questions/${a.id}`),m.success("Question deleted"),V()}catch(f){m.error(((i=(e=f.response)==null?void 0:e.data)==null?void 0:i.message)||"Failed to delete question")}},O=()=>{g.value=null,n.value={section_name:"",question_text:"",question_type:"short",marks:1,options_json:"",answer_key:"",order_no:0}};return le(()=>{V()}),(a,e)=>{const i=c("el-icon"),f=c("el-button"),h=c("el-input"),_=c("el-form-item"),j=c("el-option"),G=c("el-select"),S=c("el-input-number"),W=c("el-form"),X=c("el-dialog");return u(),Q(de,{title:"Paper Details",breadcrumbs:[{label:"Exam Management",route:"/exams/center"},{label:"Papers",route:"/exams/papers"},{label:"Paper Detail"}]},{default:r(()=>{var N,U,P,D;return[C.value?(u(),p("div",me,[t(i,{class:"is-loading text-4xl"},{default:r(()=>[t(b(oe))]),_:1})])):o.value?(u(),p("div",ce,[l("div",_e,[l("div",ve,[l("div",null,[l("h2",ye,d(o.value.title),1),l("p",fe,d(((N=o.value.exam)==null?void 0:N.name)||((U=o.value.exam)==null?void 0:U.term))+" - "+d((P=o.value.class)==null?void 0:P.name)+" - "+d((D=o.value.subject)==null?void 0:D.name),1)]),t(A,{label:o.value.status,status:z(o.value.status)},null,8,["label","status"])]),l("div",xe,[l("div",null,[e[10]||(e[10]=l("p",{class:"text-sm text-gray-500 dark:text-gray-400"},"Total Marks",-1)),l("p",ge,d(o.value.total_marks),1)]),l("div",null,[e[11]||(e[11]=l("p",{class:"text-sm text-gray-500 dark:text-gray-400"},"Duration",-1)),l("p",be,d(o.value.duration_minutes)+" minutes",1)]),l("div",null,[e[12]||(e[12]=l("p",{class:"text-sm text-gray-500 dark:text-gray-400"},"Version",-1)),l("p",ke,"v"+d(o.value.paper_version),1)])]),o.value.instructions?(u(),p("div",we,[e[13]||(e[13]=l("p",{class:"text-sm text-gray-500 dark:text-gray-400 mb-1"},"Instructions",-1)),l("p",Ve,d(o.value.instructions),1)])):v("",!0),o.value.status==="draft"?(u(),Q(pe,{key:1},{default:r(()=>[t(M,{label:"Add Question",icon:b(ne),variant:"primary",onClick:e[0]||(e[0]=s=>y.value=!0)},null,8,["icon"]),t(M,{label:"Submit for Review",icon:b(re),variant:"success",onClick:I},null,8,["icon"])]),_:1})):v("",!0)]),l("div",he,[t(ie,{title:"Questions",icon:b(F)},null,8,["icon"]),o.value.questions&&o.value.questions.length>0?(u(),p("div",Qe,[(u(!0),p(B,null,J(R.value,(s,Y)=>(u(),p("div",{key:s.id,class:"p-4 bg-gray-50 dark:bg-gray-700/50 rounded-lg border border-gray-200 dark:border-gray-600"},[l("div",qe,[l("div",Ce,[l("div",je,[l("span",$e,"Q"+d(Y+1),1),t(A,{label:s.section_name,status:"info"},null,8,["label"]),t(A,{label:s.question_type.toUpperCase(),status:"default"},null,8,["label"]),l("span",Ae,d(s.marks)+" marks",1)]),l("p",Oe,d(s.question_text),1),s.options_json?(u(),p("div",Se,[e[14]||(e[14]=l("p",{class:"font-semibold mb-1"},"Options:",-1)),l("ul",Ne,[(u(!0),p(B,null,J(JSON.parse(s.options_json),($,Z)=>(u(),p("li",{key:Z},d($),1))),128))])])):v("",!0),s.answer_key?(u(),p("div",Ue,[l("p",Pe," Answer: "+d(s.answer_key),1)])):v("",!0)]),o.value.status==="draft"?(u(),p("div",De,[t(f,{text:"",type:"primary",size:"small",onClick:$=>H(s)},{default:r(()=>[...e[15]||(e[15]=[q(" Edit ",-1)])]),_:1},8,["onClick"]),t(f,{text:"",type:"danger",size:"small",onClick:$=>K(s)},{default:r(()=>[...e[16]||(e[16]=[q(" Delete ",-1)])]),_:1},8,["onClick"])])):v("",!0)])]))),128))])):(u(),Q(ue,{key:1,title:"No questions yet",description:"Add questions to build this paper",icon:b(F),"icon-color":"gray","action-label":"Add Question",onAction:e[1]||(e[1]=s=>y.value=!0)},null,8,["icon"]))])])):v("",!0),t(X,{modelValue:y.value,"onUpdate:modelValue":e[9]||(e[9]=s=>y.value=s),title:g.value?"Edit Question":"Add Question",width:"700px"},{footer:r(()=>[t(f,{onClick:O},{default:r(()=>[...e[17]||(e[17]=[q("Cancel",-1)])]),_:1}),t(f,{type:"primary",onClick:L,loading:w.value},{default:r(()=>[...e[18]||(e[18]=[q("Save",-1)])]),_:1},8,["loading"])]),default:r(()=>[t(W,{model:n.value,"label-width":"120px"},{default:r(()=>[t(_,{label:"Section",required:""},{default:r(()=>[t(h,{modelValue:n.value.section_name,"onUpdate:modelValue":e[2]||(e[2]=s=>n.value.section_name=s),placeholder:"e.g., Section A, MCQ, etc."},null,8,["modelValue"])]),_:1}),t(_,{label:"Type",required:""},{default:r(()=>[t(G,{modelValue:n.value.question_type,"onUpdate:modelValue":e[3]||(e[3]=s=>n.value.question_type=s),class:"w-full"},{default:r(()=>[t(j,{label:"MCQ",value:"mcq"}),t(j,{label:"Short Answer",value:"short"}),t(j,{label:"Long Answer",value:"long"})]),_:1},8,["modelValue"])]),_:1}),t(_,{label:"Question Text",required:""},{default:r(()=>[t(h,{modelValue:n.value.question_text,"onUpdate:modelValue":e[4]||(e[4]=s=>n.value.question_text=s),type:"textarea",rows:3,placeholder:"Enter question text"},null,8,["modelValue"])]),_:1}),t(_,{label:"Marks",required:""},{default:r(()=>[t(S,{modelValue:n.value.marks,"onUpdate:modelValue":e[5]||(e[5]=s=>n.value.marks=s),min:1,class:"w-full"},null,8,["modelValue"])]),_:1}),n.value.question_type==="mcq"?(u(),Q(_,{key:0,label:"Options (JSON)"},{default:r(()=>[t(h,{modelValue:n.value.options_json,"onUpdate:modelValue":e[6]||(e[6]=s=>n.value.options_json=s),type:"textarea",rows:4,placeholder:'["Option A", "Option B", "Option C", "Option D"]'},null,8,["modelValue"])]),_:1})):v("",!0),t(_,{label:"Answer Key"},{default:r(()=>[t(h,{modelValue:n.value.answer_key,"onUpdate:modelValue":e[7]||(e[7]=s=>n.value.answer_key=s),placeholder:"Correct answer"},null,8,["modelValue"])]),_:1}),t(_,{label:"Order"},{default:r(()=>[t(S,{modelValue:n.value.order_no,"onUpdate:modelValue":e[8]||(e[8]=s=>n.value.order_no=s),min:0,class:"w-full"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])]}),_:1})}}};export{Te as default};
