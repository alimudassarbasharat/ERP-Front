import{c as U,a as v,o,d as a,b as I,g as W,t as m,e as z,M as Z,H as ee,l as i,p as te,y as D,f as k,D as u,h as s,u as l,al as ae,a3 as P,at as se,au as le,av as E,aw as R,aq as re,ax as ne,a0 as oe,X as de,ao as ie,ar as ue,F as N,z as S,$ as ce,ay as O,ap as ge,i as A,as as me,R as f}from"./index-xvPUEXLW.js";import{_ as F}from"./KPICard-wUq3RHeB.js";import{A as pe}from"./ActionBar-BRIEgU-p.js";import{_ as K}from"./ActivityItem-Xa4YSpzk.js";const fe={class:"text-sm font-semibold text-gray-700 dark:text-gray-300 mb-1"},ve={key:0,class:"text-xs text-gray-600 dark:text-gray-400 mt-1"},H={__name:"InsightCard",props:{label:{type:String,required:!0},value:{type:[String,Number],required:!0},description:{type:String,default:null},color:{type:String,default:"orange"}},setup(x){const b=x,d=U(()=>{const c={orange:"bg-gradient-to-br from-orange-50 to-red-50 dark:from-orange-900/20 dark:to-red-900/20 border-orange-200 dark:border-orange-800",blue:"bg-gradient-to-br from-blue-50 to-indigo-50 dark:from-blue-900/20 dark:to-indigo-900/20 border-blue-200 dark:border-blue-800",green:"bg-gradient-to-br from-green-50 to-emerald-50 dark:from-green-900/20 dark:to-emerald-900/20 border-green-200 dark:border-green-800",purple:"bg-gradient-to-br from-purple-50 to-pink-50 dark:from-purple-900/20 dark:to-pink-900/20 border-purple-200 dark:border-purple-800",red:"bg-gradient-to-br from-red-50 to-pink-50 dark:from-red-900/20 dark:to-pink-900/20 border-red-200 dark:border-red-800"};return c[b.color]||c.orange}),T=U(()=>{const c={orange:"text-orange-600 dark:text-orange-400",blue:"text-blue-600 dark:text-blue-400",green:"text-green-600 dark:text-green-400",purple:"text-purple-600 dark:text-purple-400",red:"text-red-600 dark:text-red-400"};return c[b.color]||c.orange});return(c,Y)=>(o(),v("div",{class:z(["p-4 rounded-lg border",d.value])},[a("p",fe,m(x.label),1),a("p",{class:z(["text-lg font-bold mb-1",T.value])},m(x.value),3),x.description?(o(),v("p",ve,m(x.description),1)):I("",!0),W(c.$slots,"default")],2))}},be={class:"w-full mb-4"},ye={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-3 sm:gap-4"},he={class:"w-full mb-4"},xe={class:"bg-white dark:bg-gray-800 rounded-xl p-6 shadow-lg border border-gray-200 dark:border-gray-700"},_e={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ke={class:"space-y-1"},we={class:"text-gray-600 dark:text-gray-400"},Ce={class:"font-semibold text-blue-600 dark:text-blue-400"},Me={class:"w-full mb-4"},Ve={class:"grid grid-cols-1 lg:grid-cols-3 gap-4"},$e={class:"bg-white dark:bg-gray-800 rounded-xl p-6 shadow-lg border border-gray-200 dark:border-gray-700"},Fe={class:"flex items-center justify-between mb-4"},Te={class:"space-y-3"},Ye={class:"w-10 h-10 rounded-full bg-red-100 dark:bg-red-900/30 flex items-center justify-center flex-shrink-0"},De={class:"flex-1 min-w-0"},Pe={class:"text-sm font-semibold text-gray-900 dark:text-white truncate"},Re={class:"text-xs text-gray-600 dark:text-gray-400"},Ne={class:"text-right"},Se={class:"text-sm font-bold text-red-600 dark:text-red-400"},Ae={class:"text-xs text-gray-500 dark:text-gray-500"},Ie={class:"bg-white dark:bg-gray-800 rounded-xl p-6 shadow-lg border border-gray-200 dark:border-gray-700"},je={class:"flex items-center justify-between mb-4"},Be={class:"space-y-3"},Ge={class:"bg-white dark:bg-gray-800 rounded-xl p-6 shadow-lg border border-gray-200 dark:border-gray-700"},Oe={class:"flex items-center justify-between mb-4"},qe={class:"space-y-3"},Ue={class:"space-y-4"},ze={class:"space-y-4"},Qe={__name:"FeeManagement",setup(x){const b=Z(),d=ee(),T=i(!1),c=i(!1),Y=i(!1),w=i(!1),C=i(!1),M=i(null),V=i(null),g=i({expectedThisMonth:0,collected:0,pending:0,overdue:0,overdueCount:0,disputes:0,collectedTrend:null,pendingTrend:null}),$=i({overdueChange:0,topPendingClasses:[]}),j=i([]),B=i([]),G=i([]),y=r=>new Intl.NumberFormat("en-PK",{style:"currency",currency:"PKR",minimumFractionDigits:0,maximumFractionDigits:0}).format(r||0),q=async()=>{T.value=!0;try{const r=new Date().toISOString().slice(0,7),[e,n,p,h,_]=await Promise.all([f.get("/fee-management/summary",{params:{month:r}}),f.get("/fee-management/defaulters",{params:{limit:10}}),f.get("/fee-management/recent-payments",{params:{limit:10}}),f.get("/fee-management/recent-disputes",{params:{limit:10}}),f.get("/fee-management/insights",{params:{month:r}})]);if(e.data.success){const t=e.data.data;g.value={expectedThisMonth:t.expected_this_month||0,collected:t.collected||0,pending:t.pending||0,overdue:t.overdue||0,overdueCount:t.overdue_count||0,disputes:t.disputes||0,collectedTrend:t.collected_trend||null,pendingTrend:t.pending_trend||null}}n.data.success&&(j.value=n.data.data||[]),p.data.success&&(B.value=p.data.data||[]),h.data.success&&(G.value=h.data.data||[]),_.data.success&&($.value={overdueChange:_.data.data.overdue_change||0,topPendingClasses:_.data.data.top_pending_classes||[]})}catch(r){console.error("Failed to load dashboard data:",r),d.error("Failed to load fee dashboard data")}finally{T.value=!1}},L=async()=>{var r,e;if(!M.value){d.warning("Please select a month");return}c.value=!0;try{const n=await f.post("/fee-management/generate-monthly-fees",{month:M.value,confirm:!0});n.data.success&&(n.data.job_batch_id?d.success("Monthly fees are being created. This may take a few minutes."):d.success("Monthly fees created successfully"),w.value=!1,M.value=null,setTimeout(()=>q(),2e3))}catch(n){d.error(((e=(r=n.response)==null?void 0:r.data)==null?void 0:e.message)||"Failed to create monthly fees")}finally{c.value=!1}},Q=async()=>{var r,e;if(!V.value){d.warning("Please select a month");return}Y.value=!0;try{(await f.post("/generate-challans",{month:V.value})).data.success&&(d.success("Fee vouchers are being generated"),C.value=!1,V.value=null)}catch(n){d.error(((e=(r=n.response)==null?void 0:r.data)==null?void 0:e.message)||"Failed to generate vouchers")}finally{Y.value=!1}},X=async()=>{var r,e;try{const n=new Date().toISOString().slice(0,7),p=await f.post("/fee-management/send-reminders",{month:n});p.data.success&&(p.data.job_batch_id?d.success("Reminders are being sent. This may take a few minutes."):d.success("Reminders sent successfully"))}catch(n){d.error(((e=(r=n.response)==null?void 0:r.data)==null?void 0:e.message)||"Failed to send reminders")}};return te(()=>{q()}),(r,e)=>{const n=D("el-icon"),p=D("el-date-picker"),h=D("el-button"),_=D("el-dialog");return o(),k(me,{title:"Fee Management Dashboard",breadcrumbs:[{label:"Fee Management",route:null},{label:"Analytics",route:"/fees/analytics"}]},{default:u(()=>[a("div",be,[a("div",ye,[s(F,{label:"Expected This Month",value:y(g.value.expectedThisMonth),icon:l(ae),"icon-bg-class":"bg-gradient-to-br from-blue-100 to-indigo-100","icon-class":"text-blue-600"},null,8,["value","icon"]),s(F,{label:"Collected",value:y(g.value.collected),icon:l(P),"icon-bg-class":"bg-gradient-to-br from-green-100 to-emerald-100","icon-class":"text-green-600",trend:g.value.collectedTrend},null,8,["value","icon","trend"]),s(F,{label:"Pending",value:y(g.value.pending),icon:l(se),"icon-bg-class":"bg-gradient-to-br from-orange-100 to-amber-100","icon-class":"text-orange-600",trend:g.value.pendingTrend},null,8,["value","icon","trend"]),s(F,{label:"Overdue",value:y(g.value.overdue),icon:l(le),"icon-bg-class":"bg-gradient-to-br from-red-100 to-pink-100","icon-class":"text-red-600",badge:`${g.value.overdueCount} invoices`,"badge-class":"text-red-600 bg-red-100"},null,8,["value","icon","badge"]),s(F,{label:"Disputes",value:g.value.disputes,icon:l(E),"icon-bg-class":"bg-gradient-to-br from-yellow-100 to-orange-100","icon-class":"text-yellow-600",badge:g.value.disputes>0?"Needs attention":"All clear","badge-class":g.value.disputes>0?"text-yellow-600 bg-yellow-100":"text-green-600 bg-green-100"},null,8,["value","icon","badge","badge-class"])])]),s(pe,null,{default:u(()=>[s(R,{label:"Create Monthly Fees",icon:l(re),variant:"primary",onClick:e[0]||(e[0]=t=>w.value=!0)},null,8,["icon"]),s(R,{label:"Generate Fee Vouchers",icon:l(ne),variant:"info",onClick:e[1]||(e[1]=t=>C.value=!0)},null,8,["icon"]),s(R,{label:"Send Reminders",icon:l(oe),variant:"warning",onClick:X},null,8,["icon"]),s(R,{label:"View All Payments",icon:l(de),variant:"secondary",onClick:e[2]||(e[2]=t=>l(b).push("/fees/collection"))},null,8,["icon"])]),_:1}),a("div",he,[a("div",xe,[s(ie,{title:"Quick Insights",icon:l(ue)},null,8,["icon"]),a("div",_e,[s(H,{label:"Overdue Trend",value:`${$.value.overdueChange>0?"+":""}${$.value.overdueChange}% vs last month`,description:`${$.value.overdueChange>0?"Increased":"Decreased"} compared to previous month`,color:"orange"},null,8,["value","description"]),s(H,{label:"Top Classes with Pending",value:"",color:"blue"},{default:u(()=>[a("div",ke,[(o(!0),v(N,null,S($.value.topPendingClasses,(t,J)=>(o(),v("div",{key:J,class:"flex justify-between text-sm"},[a("span",we,m(t.name),1),a("span",Ce,m(y(t.amount)),1)]))),128))])]),_:1})])])]),a("div",Me,[a("div",Ve,[a("div",$e,[a("div",Fe,[e[12]||(e[12]=a("h3",{class:"text-lg font-bold text-gray-900 dark:text-white"},"Top Defaulters",-1)),a("button",{onClick:e[3]||(e[3]=t=>l(b).push("/fees/collection?filter=overdue")),class:"text-xs text-purple-600 dark:text-purple-400 hover:underline"}," View All ")]),a("div",Te,[(o(!0),v(N,null,S(j.value.slice(0,5),t=>(o(),v("div",{key:t.id,class:"flex items-center gap-3 p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors"},[a("div",Ye,[s(n,{class:"text-red-600 dark:text-red-400"},{default:u(()=>[s(l(ce))]),_:1})]),a("div",De,[a("p",Pe,m(t.student_name),1),a("p",Re,m(t.className),1)]),a("div",Ne,[a("p",Se,m(y(t.amount)),1),a("p",Ae,m(t.daysOverdue)+" days",1)])]))),128)),j.value.length===0?(o(),k(O,{key:0,title:"No defaulters",description:"All fees are up to date",icon:l(P),"icon-color":"green"},null,8,["icon"])):I("",!0)])]),a("div",Ie,[a("div",je,[e[13]||(e[13]=a("h3",{class:"text-lg font-bold text-gray-900 dark:text-white"},"Recent Payments",-1)),a("button",{onClick:e[4]||(e[4]=t=>l(b).push("/fees/collection")),class:"text-xs text-purple-600 dark:text-purple-400 hover:underline"}," View All ")]),a("div",Be,[(o(!0),v(N,null,S(B.value.slice(0,5),t=>(o(),k(K,{key:t.id,title:t.studentName,description:t.time,time:t.time,amount:t.amount,type:"payment",icon:l(P),"format-currency":y},null,8,["title","description","time","amount","icon"]))),128)),B.value.length===0?(o(),k(O,{key:0,title:"No recent payments",description:"Payment history will appear here",icon:l(ge),"icon-color":"gray"},null,8,["icon"])):I("",!0)])]),a("div",Ge,[a("div",Oe,[e[14]||(e[14]=a("h3",{class:"text-lg font-bold text-gray-900 dark:text-white"},"Recent Disputes",-1)),a("button",{onClick:e[5]||(e[5]=t=>l(b).push("/fees/collection?filter=disputes")),class:"text-xs text-purple-600 dark:text-purple-400 hover:underline"}," View All ")]),a("div",qe,[(o(!0),v(N,null,S(G.value.slice(0,5),t=>(o(),k(K,{key:t.id,title:t.studentName,description:t.reason,time:t.time,type:"notification",icon:l(E)},null,8,["title","description","time","icon"]))),128)),G.value.length===0?(o(),k(O,{key:0,title:"No disputes",description:"All fee matters are resolved",icon:l(P),"icon-color":"green"},null,8,["icon"])):I("",!0)])])])]),s(_,{modelValue:w.value,"onUpdate:modelValue":e[8]||(e[8]=t=>w.value=t),title:"Create Monthly Fees",width:"500px",class:"rounded-2xl"},{footer:u(()=>[s(h,{onClick:e[7]||(e[7]=t=>w.value=!1)},{default:u(()=>[...e[16]||(e[16]=[A("Cancel",-1)])]),_:1}),s(h,{type:"primary",onClick:L,loading:c.value},{default:u(()=>[...e[17]||(e[17]=[A("Create Fees",-1)])]),_:1},8,["loading"])]),default:u(()=>[a("div",Ue,[e[15]||(e[15]=a("p",{class:"text-gray-600 dark:text-gray-400"},"This will create fee invoices for all students for the selected month.",-1)),s(p,{modelValue:M.value,"onUpdate:modelValue":e[6]||(e[6]=t=>M.value=t),type:"month",placeholder:"Select month",format:"MMMM YYYY","value-format":"YYYY-MM",class:"w-full"},null,8,["modelValue"])])]),_:1},8,["modelValue"]),s(_,{modelValue:C.value,"onUpdate:modelValue":e[11]||(e[11]=t=>C.value=t),title:"Generate Fee Vouchers",width:"500px",class:"rounded-2xl"},{footer:u(()=>[s(h,{onClick:e[10]||(e[10]=t=>C.value=!1)},{default:u(()=>[...e[19]||(e[19]=[A("Cancel",-1)])]),_:1}),s(h,{type:"primary",onClick:Q,loading:Y.value},{default:u(()=>[...e[20]||(e[20]=[A("Generate Vouchers",-1)])]),_:1},8,["loading"])]),default:u(()=>[a("div",ze,[e[18]||(e[18]=a("p",{class:"text-gray-600 dark:text-gray-400"},"This will generate fee vouchers (challans) for all pending invoices for the selected month.",-1)),s(p,{modelValue:V.value,"onUpdate:modelValue":e[9]||(e[9]=t=>V.value=t),type:"month",placeholder:"Select month",format:"MMMM YYYY","value-format":"YYYY-MM",class:"w-full"},null,8,["modelValue"])])]),_:1},8,["modelValue"])]),_:1})}}};export{Qe as default};
